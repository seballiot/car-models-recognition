{% extends "layout.html" %}

{% block content %}

<link href="{{ url_for('static', filename='css/speedometer.css') }}" rel="stylesheet">

<div class="pt-4 pb-2 mb-3 border-bottom">
    <h2>Résultat de l'analyse de l'image</h2>
</div>

<style>
.custom-range::-webkit-slider-runnable-track {
  background: linear-gradient(.25turn, red, 30%, yellow, 90%, green);
}

.custom-range::-webkit-slider-thumb {
  background: black;
}

.custom-range::-moz-range-thumb {
background: black;
}

.custom-range::-ms-thumb {
background: black;
}
</style>

<div class="card shadow border-0">
    <div class="card-body">
        <div class="row">
            <div class="col-lg-4 text-center">
                <div><img src="{{ url_for('static', filename='cars_img/'+filename) }}" width="100%"></div>
            </div>
            <div class="col-lg-8">
                <div class="row align-items-center">
                    <div class="col">
                        <h5>Modèle : <span class="badge bg-primary">{{ predictions[0]['label'] }}</span></h5>
                        <div>
                            <small>Durée du <span class="bg-light rounded">model.predict()</span>  : {{ exec_time_pred }}s</small>
                        </div>
                    </div>
                    <div class="col-5">
                        <h6 class="text-center"><u>Indicateur de fiabilité</u> : {{ predictions[0]['proba'] }}%</h6>
                        <input type="range" class="form-range custom-range" id="customRange1" disabled min="0" max="100" value="{{ predictions[0]['proba'] }}">
                    </div>
                </div>

                <h6 class="mt-4"><u>Classement des 5 meilleures prédictions</u></h6>
                <canvas id="bar-chart-horizontal" height="80"></canvas>
            </div>
        </div>
    </div>
</div>

<div class="card shadow border-0 mt-5">
    <div class="card-body">
        <h5>Fiche technique</h5>
        <br>
        <div>Todo graphs avec info voiture</div>
        <div>Comparatif autre modèle similaire</div>
        <h6><u>Vitesse maximale</u></h6>
        <input id="myValues" value="{{ car.vitesse_max }}" class="d-none">
    </div>
</div>

<!-- 150 : 10 -->
<!-- 200 : 10 -->
<!-- 250 : 10 -->
<!-- 300 : 15 -->

{% endblock %}

{% block js %}

    $("#myValues").speedometer({
        divFact: {{ 10 if car.vitesse_max<270 else 15 }},
        maxVal: {{ car.vitesse_max }},
        dangerLevel: {{ car.vitesse_max-30 }}
    });

    $( document ).ready(function(){
        $("#myValues").change()
    });

    new Chart(document.getElementById("bar-chart-horizontal"), {
        type: 'horizontalBar',
        data: {
          labels: [
            "{{ predictions[0]['label'] }} ({{ predictions[0]['proba'] }}%)",
            "{{ predictions[1]['label'] }} ({{ predictions[1]['proba'] }}%)",
            "{{ predictions[2]['label'] }} ({{ predictions[2]['proba'] }}%)",
            "{{ predictions[3]['label'] }} ({{ predictions[3]['proba'] }}%)",
            "{{ predictions[4]['label'] }} ({{ predictions[4]['proba'] }}%)",
            ],
          datasets: [
            {
              label: "Prediction (%)",
              backgroundColor: ["#3cba9f", "#8e5ea2","#e8c3b9", "rgba(255,221,50,0.6)", "rgba(0,0,0,0.2)"],
              data: [
                {{ predictions[0]['proba'] }},
                {{ predictions[1]['proba'] }},
                {{ predictions[2]['proba'] }},
                {{ predictions[3]['proba'] }},
                {{ predictions[4]['proba'] }}
                ],
                barThickness: 20
            }
          ]
        },
        options: {
          legend: { display: false },
            scales: {
                yAxes: [{
                gridLines: {
                    display:false
                },
                ticks: {
                suggestedMin: 100,    // minimum will be 0, unless there is a lower value.
                // OR //
                beginAtZero: true   // minimum value will be 0.
            }
            }]
          }
        }
    });
{% endblock %}